var ImagePaster=function(url){this.debug=!0,this.url=url,this.pasteCatcher=null,this.init()};ImagePaster.prototype.log=function(data,extra){this.debug&&console.log(data,extra)},ImagePaster.prototype.init=function(){var self=this;self.pasteCatcher=document.createElement("div"),self.pasteCatcher.setAttribute("contenteditable",""),self.pasteCatcher.id="paste-catcher",document.body.appendChild(self.pasteCatcher),self.pasteCatcher.focus(),document.addEventListener("paste",function(event){self.onPaste(event)}),$(document).on("keydown",function(e){86==e.which&&(e.ctrlKey||e.metaKey)&&$(document).trigger("ctrlVPressed")}),$(document).on("ctrlVPressed",function(e){self.pasteCatcher.focus()})},ImagePaster.prototype.onPaste=function(event){var clipboardData,self=this,done=!1;if(self.log("onPaste",JSON.stringify(event)),event.clipboardData?clipboardData=event.clipboardData:window.clipboardData&&(clipboardData=window.clipboardData),event.msConvertURL){var fileList=clipboardData.files;if(fileList.length>0)for(var i=0;i<fileList.length;i++)self.uploadBlob(fileList[i]),done=!0}if(clipboardData&&clipboardData.items){var text;if(text=clipboardData.getData("text/plain"))return self.uploadText(text),void self.clearPasteCatcher();for(var x=0;x<clipboardData.items.length;x++)-1!==clipboardData.items[x].type.indexOf("image")&&(self.uploadBlob(clipboardData.items[x].getAsFile()),done=!0)}done?self.clearPasteCatcher():setTimeout(function(){self.checkPasteCatcher()},10)},ImagePaster.prototype.checkPasteCatcher=function(){var text=this.pasteCatcher.innerHTML,child=this.pasteCatcher.childNodes[0];if(child)if("IMG"==child.tagName){if(-1!=child.src.indexOf("webkit-fake-url://"))return this.onFail("Sorry, Safari does not currently support pasting images."),!1;this.uploadImage(child.src)}else"A"===child.tagName?this.uploadText(child.href):this.uploadText(text);this.clearPasteCatcher()},ImagePaster.prototype.clearPasteCatcher=function(){var self=this;setTimeout(function(){self.pasteCatcher.innerHTML=""},1)},ImagePaster.prototype.uploadBlob=function(blob){if(blob){var self=this,reader=new FileReader;reader.onload=function(evt){self.uploadImage(evt.target.result)},reader.readAsDataURL(blob)}},ImagePaster.prototype.uploadText=function(text){return console.log("uploadText",text),this.upload("text",text)},ImagePaster.prototype.uploadImage=function(base64){return this.upload("uploadImage",base64)},ImagePaster.prototype.upload=function(format,data){var self=this;$(document).trigger("ctrlvuploadstart"),$.ajax({url:this.url,timeout:9e4,type:"POST",data:{format:format,base64:data},error:function(jqXHR,textStatus){var message;switch(textStatus){case"timeout":message="The image took too long to upload";break;case"error":message=jqXHR.responseJSON&&jqXHR.responseJSON.message?"CtrlV server error ("+jqXHR.responseJSON.errorType+" "+jqXHR.responseJSON.message+")":0!==jqXHR.status?"CtrlV server error ("+jqXHR.status+" "+jqXHR.statusText+")":"Can't connect to the CtrlV server";break;case"abort":message="The upload was cancelled";break;case"parsererror":message="Error uploading: couldn't decode the response from the server";break;default:message=textStatus}self.onFail(message)},success:function(res){res.image?$(document).trigger({type:"ctrlvuploadcomplete",image:res.image}):self.onFail(res.message)}})},ImagePaster.prototype.onFail=function(message){$(document).trigger({type:"ctrlvuploaderror",message:message?message:!1})},ImagePaster.prototype.validateURL=function(text){var regex=new RegExp("^(http|https|ftp)://([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&amp;%$-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9-]+.)*[a-zA-Z0-9-]+.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(/($|[a-zA-Z0-9.,?'\\+&amp;%$#=~_-]+))*$");return regex.test(text)};var host;if(window.opener&&window.opener.frames.length>0){var target=location.hash.substring(9);if(target="easyXDM_"+target+"_provider",host=window.opener.frames[target],window.opener){try{window.opener.document.title&&(host=window.opener)}catch(xDomainError){host=window.opener.frames[target]}if(host)try{host.setApp(window)}catch(browserHostError){alert("was unable to gain a reference to the iframe")}}}var image=null;$(document).on("click","#restart-btn",function(e){e.preventDefault(),$(".upload-status").addClass("out"),$("#upload-waiting").removeClass("out"),$("#container").css("background-image",""),image=null}),$(document).on("click","#accept-btn",function(e){e.preventDefault(),host&&(host.sendData({image:image}),setTimeout(function(){window.close()},500))}),$(document).on("ctrlvuploadstart",function(){$(".upload-status").addClass("out"),$("#upload-loading").removeClass("out")}),$(document).on("ctrlvuploadcomplete",function(e){$(".upload-status").addClass("out"),$("#upload-complete").removeClass("out");var viewUrl=e.image.url,imageUrl=e.image.image.url;$("#view-btn").attr("href",viewUrl),$("#container").css("background-image","url("+imageUrl+")")}),$(document).on("ctrlvuploaderror",function(e){$(".upload-status").addClass("out"),$("#upload-error").removeClass("out").find("p").text(e.message)}),$(document).on("keyup",function(e){91==e.which||224===e.which?$(".kbd-cmd").removeClass("pressed"):17==e.which?$(".kbd-ctrl").removeClass("pressed"):86==e.which&&$(".kbd-v").removeClass("pressed")}),$(document).on("keydown",function(e){console.log(e),91==e.which||224===e.which?$(".kbd-cmd").addClass("pressed"):17==e.which?$(".kbd-ctrl").addClass("pressed"):86==e.which&&$(".kbd-v").addClass("pressed")});
//# sourceMappingURL=uploader.min.js.map