var ImagePaster=function(url){this.url=url,this.pasteCatcher=null,this.init()};ImagePaster.prototype.init=function(){var self=this;self.pasteCatcher=document.createElement("div"),self.pasteCatcher.setAttribute("contenteditable",""),self.pasteCatcher.id="paste-catcher",document.body.appendChild(self.pasteCatcher),self.pasteCatcher.focus(),document.addEventListener("paste",function(event){self.onPaste(event)}),$(document).on("keydown",function(e){86==e.which&&(e.ctrlKey||e.metaKey)&&$(document).trigger("ctrlVPressed")}),$(document).on("ctrlVPressed",function(e){self.pasteCatcher.focus()})},ImagePaster.prototype.onPaste=function(event){var clipboardData,self=this,done=!1;if(event.clipboardData?clipboardData=event.clipboardData:window.clipboardData&&(clipboardData=window.clipboardData),event.msConvertURL){var fileList=clipboardData.files;if(fileList.length>0)for(var i=0;i<fileList.length;i++){var blob=fileList[i];self.uploadBlob(blob),done=!0}}if(clipboardData&&clipboardData.items){if(text=clipboardData.getData("text/plain"))return self.uploadText(text),void self.clearPasteCatcher();for(var i=0;i<clipboardData.items.length;i++)if(-1!==clipboardData.items[i].type.indexOf("image")){var blob=clipboardData.items[i].getAsFile();self.uploadBlob(blob),done=!0}}done?self.clearPasteCatcher():setTimeout(function(){self.checkPasteCatcher()},1)},ImagePaster.prototype.checkPasteCatcher=function(){var text=this.pasteCatcher.innerHTML,child=this.pasteCatcher.childNodes[0];if(child)if("IMG"===child.tagName){if(-1!=child.src.indexOf("webkit-fake-url://"))return this.onFail("Sorry, Safari does not currently support pasting images."),!1;this.uploadImage(child.src)}else"A"===child.tagName?this.uploadText(child.href):this.uploadText(text);this.clearPasteCatcher()},ImagePaster.prototype.clearPasteCatcher=function(){var self=this;setTimeout(function(){self.pasteCatcher.innerHTML=""},1)},ImagePaster.prototype.uploadBlob=function(blob){if(blob){var self=this;reader=new FileReader,reader.onload=function(evt){self.uploadImage(evt.target.result)},reader.readAsDataURL(blob)}},ImagePaster.prototype.uploadText=function(text){return console.log("uploadText",text),this.upload("text",text)},ImagePaster.prototype.uploadImage=function(base64){return this.upload("uploadImage",base64)},ImagePaster.prototype.upload=function(format,data){var self=this;$(document).trigger("ctrlvuploadstart"),$.ajax({url:this.url,timeout:9e4,type:"POST",data:{format:format,base64:data},error:function(jqXHR,textStatus){var message=textStatus;switch(textStatus){case"timeout":message="The image took too long to upload";break;case"error":message=0!==jqXHR.status?"CtrlV server error ("+jqXHR.status+" "+jqXHR.statusText+")":"Can't connect to the CtrlV server";break;case"abort":message="The upload was cancelled";break;case"parsererror":message="Error uploading: couldn't decode the response from the server"}self.onFail(message)},success:function(res){res.image?$(document).trigger({type:"ctrlvuploadcomplete",image:res.image}):self.onFail(res.message)}})},ImagePaster.prototype.onFail=function(message){$(document).trigger({type:"ctrlvuploaderror",message:message?message:!1})},ImagePaster.prototype.validateURL=function(text){var regex=new RegExp("^(http|https|ftp)://([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&amp;%$-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9-]+.)*[a-zA-Z0-9-]+.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(/($|[a-zA-Z0-9.,?'\\+&amp;%$#=~_-]+))*$");return regex.test(text)};var host;if(window.opener&&window.opener.frames){var target=location.hash.substring(9);target="easyXDM_"+target+"_provider";var host=window.opener.frames[target];if(window.opener){try{window.opener.document.title&&(host=window.opener)}catch(xDomainError){host=window.opener.frames[target]}if(host)try{host.setApp(window)}catch(browserHostError){alert("was unable to gain a reference to the iframe")}}}var image=null;$(document).on("click",".restart-btn",function(e){e.preventDefault(),$(".upload-status").addClass("out"),$("#upload-waiting").removeClass("out"),$("#container").css("background-image",""),image=null}),$(document).on("click",".accept-btn",function(e){e.preventDefault(),host&&(host.sendData({image:image}),setTimeout(function(){window.close()},500))}),$(document).on("ctrlvuploadstart",function(){$(".upload-status").addClass("out"),$("#upload-loading").removeClass("out")}),$(document).on("ctrlvuploadcomplete",function(e){$(".upload-status").addClass("out"),$("#upload-complete").removeClass("out"),image=e.image,$("#container").css("background-image","url("+e.image.urls.image+")")}),$(document).on("ctrlvuploaderror",function(e){$(".upload-status").addClass("out"),$("#upload-error").removeClass("out"),$("#upload-error p").text(e.message)}),$(document).on("keyup",function(e){91==e.which?$(".kbd-cmd").removeClass("pressed"):17==e.which?$(".kbd-ctrlv").removeClass("pressed"):86==e.which&&$(".kbd-v").removeClass("pressed")}),$(document).on("keydown",function(e){91==e.which?$(".kbd-cmd").addClass("pressed"):17==e.which?$(".kbd-ctrlv").addClass("pressed"):86==e.which&&$(".kbd-v").addClass("pressed")});
//# sourceMappingURL=uploader.min.js.map